(function(t){var e;return e=function(){function e(){var n=this;this.resize=function(){return e.prototype.resize.apply(n,arguments)},this.hide=function(){return e.prototype.hide.apply(n,arguments)},this.slide=function(){return e.prototype.slide.apply(n,arguments)},this.newTweetAppend=function(){return e.prototype.newTweetAppend.apply(n,arguments)},this.articleSelectedHandler=function(){return e.prototype.articleSelectedHandler.apply(n,arguments)},this.modelLoaded=function(){return e.prototype.modelLoaded.apply(n,arguments)},this.load=function(){return e.prototype.load.apply(n,arguments)},this.hasModelLoaded=function(){return e.prototype.hasModelLoaded.apply(n,arguments)},this.$el=$("#main"),this.$el.on("click",".article",this.articleSelectedHandler),this.resize(),TweetModel.on(t.ModelEvent.ADDED,this.newTweetAppend),t.$win.on("resize",this.resize)}return e.prototype.$el=null,e.prototype.state=!0,e.prototype.hasModelLoaded=function(){return TweetModel.isLoaded()},e.prototype.load=function(){return TweetModel.on(t.Event.COMPLETE,this.modelLoaded).on(t.IOErrorEvent.IO_ERROR,this.loadFaild).load()},e.prototype.modelLoaded=function(){return TweetModel.off(t.Event.COMPLETE,this.modelLoaded).off(t.IOErrorEvent.IO_ERROR,this.loadFailed),TweetModel.isLoaded()?(t.App.resume(),this.render()):(console.warn("do retry"),void 0)},e.prototype.render=function(){var e,n,r,o,i;for(e="",1>TweetModel.collection.length&&(e+='<article class="article nullpo">ぬるぽ</article>'),r=TweetModel.collection,o=0,i=r.length;i>o;o++)n=r[o],e+=new t.IndexListView(n).el;return this.$el.append(e),$("#container").css({height:this.$el.height()+20})},e.prototype.articleSelectedHandler=function(e){var n,r;return e.preventDefault(),r=e.currentTarget,n=$(r).attr("id").replace("tweetlist",""),t.App.fragment==="/"+n?(t.App.change("/"),void 0):("/"!==t.App.fragment&&this.hide(),t.App.change("/"+n))},e.prototype.newTweetAppend=function(e){var n;return n=TweetModel.get(e.id),this.$el.prepend(new t.IndexListView(n).el)},e.prototype.slide=function(){return this.$el.animate({left:this.pos-420}),this.state=!1},e.prototype.hide=function(){return this.$el.animate({left:this.pos-250}),this.state=!0},e.prototype.resize=function(){var t;return t=$("#container"),this.pos=t.offset().left+t.width()/2,this.state?this.$el.css({left:this.pos-250}):this.$el.css({left:this.pos-420})},e}(),t.IndexController=e})(TECH),function(t){var e;return e=function(){function e(){var t=this;this._removeContainer=function(){return e.prototype._removeContainer.apply(t,arguments)},this._screenClickHandler=function(){return e.prototype._screenClickHandler.apply(t,arguments)},this.closeHandler=function(){return e.prototype.closeHandler.apply(t,arguments)},this.tweetErrorHandler=function(){return e.prototype.tweetErrorHandler.apply(t,arguments)},this.tweetSuccessHandler=function(){return e.prototype.tweetSuccessHandler.apply(t,arguments)},this._sendTweetHandler=function(){return e.prototype._sendTweetHandler.apply(t,arguments)},this.toggleClickHandler=function(){return e.prototype.toggleClickHandler.apply(t,arguments)},$(".new").on("click",this.toggleClickHandler)}return e.prototype.$el=null,e.prototype.$screen=null,e.prototype.toggleClickHandler=function(e){var n;return e.preventDefault(),this.$container?this._removeContainer():(n=$("body"),n.append('<div id="screen" />'),n.append('<div id="newContainer" />'),this.$el||(this.$el=(new t.NewView).el),this.$container=$("#newContainer"),this.$container.append(this.$el),this.$container.css({left:t.win.innerWidth/2-215}),$("form").on("submit",this._sendTweetHandler),$("textarea[name=text]").focus(),$(".close").on("click",this.closeHandler),this.$screen=$("#screen"),this.$screen.on("click",this._screenClickHandler))},e.prototype._sendTweetHandler=function(e){var n,r;return e.preventDefault(),n=$("#newForm").serializeArray(),r=new TweetModel,TweetModel.on(t.ModelEvent.ADDED,this.tweetSuccessHandler).on(t.IOErrorEvent.IO_ERROR,this.tweetErrorHandler),r.save(n),this._removeContainer()},e.prototype.tweetSuccessHandler=function(){return TweetModel.off(t.ModelEvent.ADDED,this.tweetSuccessHandler).off(t.IOErrorEvent.IO_ERROR,this.tweetErrorHandler),t.Alert.dispAlert("作成しました","alert-success")},e.prototype.tweetErrorHandler=function(){return console.error("失敗しました。"),t.Alert.dispAlert("失敗しました。","alert-error")},e.prototype.closeHandler=function(t){return t.preventDefault(),this._removeContainer()},e.prototype._screenClickHandler=function(t){return t.preventDefault(),this._removeContainer()},e.prototype._removeContainer=function(){return this.$container.remove(),this.$screen.remove(),this.$container=null,this.$screen=null},e}(),t.NewController=e}(TECH),function(t){var e;return e=function(){function e(){var t,n=this;this.resize=function(){return e.prototype.resize.apply(n,arguments)},this.deleteFaildHandler=function(){return e.prototype.deleteFaildHandler.apply(n,arguments)},this.deletedHandler=function(){return e.prototype.deletedHandler.apply(n,arguments)},this.deleteTweet=function(){return e.prototype.deleteTweet.apply(n,arguments)},this.deleteClickHandler=function(){return e.prototype.deleteClickHandler.apply(n,arguments)},this.editCancelHandler=function(){return e.prototype.editCancelHandler.apply(n,arguments)},this.updateFaildHandler=function(){return e.prototype.updateFaildHandler.apply(n,arguments)},this.updatedHandler=function(){return e.prototype.updatedHandler.apply(n,arguments)},this.editSendHandler=function(){return e.prototype.editSendHandler.apply(n,arguments)},this.editClickHandler=function(){return e.prototype.editClickHandler.apply(n,arguments)},this.closeHandler=function(){return e.prototype.closeHandler.apply(n,arguments)},this._errorHandler=function(){return e.prototype._errorHandler.apply(n,arguments)},this._fetchSuccessHandler=function(){return e.prototype._fetchSuccessHandler.apply(n,arguments)},this.hideAndShow=function(){return e.prototype.hideAndShow.apply(n,arguments)},t=$("#show"),(!t||1>t.length)&&($("#container").append($('<div id="show" />')),t=$("#show")),this.$el=t,this.$el.addClass("detail"),this.resize(),this.$el.on("click",".delete",this.deleteClickHandler),this.$el.on("click",".edit",this.editClickHandler),$(window).on("resize",this.resize)}return e.prototype.$el=null,e.prototype.current=null,e.prototype.isEdit=!1,e.prototype.state=!1,e.prototype.show=function(t){var e,n;return this.$el.animate({left:this.pos+80}),n="/"+t,this.state=!0,e=TweetModel.get(t),e?this._fetchSuccessHandler(e):void 0},e.prototype.hide=function(){var t=this;this.$el.animate({left:this.pos-205},function(){return t.$el.empty(),t.state=!1})},e.prototype.hideAndShow=function(t){var e=this;return this.$el.animate({left:this.pos-225},function(){return e.$el.empty(),e.show(t)})},e.prototype._fetchSuccessHandler=function(t){return this.current=t,this.$el.append(new ShowView(t).el),$(".closeShow").on("click",this.closeHandler)},e.prototype._errorHandler=function(t){return console.log(t)},e.prototype.closeHandler=function(e){return e.preventDefault(),t.App.change("/")},e.prototype.editClickHandler=function(t){var e;return t.preventDefault(),this.isEdit?!1:(e=this.$el.find(".tweet"),e.after(new EditView(this.current).el),e.hide(),$("#editView").on("click",".cancel",this.editCancelHandler),$("#editView").on("click",".send",this.editSendHandler))},e.prototype.editSendHandler=function(e){var n,r,o;return e.preventDefault(),o=$("#editView"),r=o.serializeArray(),n=o.attr("action"),TweetModel.on(t.ModelEvent.UPDATED,this.updatedHandler).on(t.IOErrorEvent.IO_ERROR,this.updateFaildHandler),this.current.update(r)},e.prototype.updatedHandler=function(){var e,n;return TweetModel.off(t.ModelEvent.UPDATED,this.updateHandler),n=this.$el.find(".tweet"),n.empty().append(this.current.text),n.show(),$("#editView").remove(),e=$("#tweetlist"+this.current.id),e.find(".tweetBody").empty().append(this.current.text),t.Alert.dispAlert("更新しました","alert-success")},e.prototype.updateFaildHandler=function(){return t.Alert.dispAlert("失敗しました。","alert-error")},e.prototype.editCancelHandler=function(){var t;return $("#editView").remove(),t=this.$el.find(".tweet"),t.show()},e.prototype.deleteClickHandler=function(e){var n;return e.preventDefault(),n=$(e.currentTarget).data("delete"),t.Alert.dispModalAlert("消してもいいの",this,this.deleteTweet,[n])},e.prototype.deleteTweet=function(){return TweetModel.on(t.ModelEvent.DELETED,this.deletedHandler).on(t.IOErrorEvent.IO_ERROR,this.deleteFaildHandler),this.current.destroy()},e.prototype.deletedHandler=function(e){var n;return n=$("#tweetlist"+e.id),n.remove(),this.current=null,t.App.change("/"),t.Alert.dispAlert("削除しました","alert-success")},e.prototype.deleteFaildHandler=function(){return t.Alert.dispAlert("失敗しました。","alert-error")},e.prototype.resize=function(){return this.pos=window.innerWidth/2,this.state?this.$el.css({left:this.pos+80}):this.$el.css({left:this.pos-205})},e}(),t.ShowController=e}(TECH),function(t){var e;return e=function(){throw Error("いつからインスタンス化出来ると錯覚していた?")},e._tmpl='<div class="modalAlert"><section class="msg"><%= msg %></section><div class="action"><button class="btn btn-primary send" type="button">OK</button><button class="btn cancel" type="button">キャンセル</button></div></div>',e.container=null,e.dispModalAlert=function(t,n,r,o){return e.target=n,e.cb=r,e.args=o,$("body").append(_.template(e._tmpl,{msg:t})),$("body").append($('<div id="screen" />')),e.container=$(".modalAlert"),e.container.css({left:window.innerWidth/2-175}),e.container.on("click",".send",e._sendHandler),e.container.on("click",".cancel",e._hideHandler)},e._sendHandler=function(t){return t.preventDefault(),e.cb.apply(e.target,e.args),$("#screen").remove(),e.container.remove(),e.container=null},e._hideHandler=function(t){return t.preventDefault(),$("#screen").remove(),e.container.remove(),e.container=null},e.dispAlert=function(t,e){var n;return n='<div class="alert <%= alertType %>"><button type="button" class="close" data-dismiss="alert">&times;</button><%= msg %></div>',$("#container").prepend(_.template(n,{msg:t,alertType:e?e:""})),$(".alert").on("click",".close",function(){return $(".alert").remove()})},t.Alert=e}(TECH),function(t){var e;return e=function(){function t(e){var n=this;if(this.type=e,this.toString=function(){return t.prototype.toString.apply(n,arguments)},!e)throw Error("type is たりてない")}return t.COMPLETE="complete",t.START="start",t.STOP="stop",t.prototype.type=null,t.prototype.toString=function(){return"Event:: type"+this.type},t}(),t.Event=e}(TECH);var __hasProp={}.hasOwnProperty,__extends=function(t,e){function n(){this.constructor=t}for(var r in e)__hasProp.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};(function(t){var e;return e=function(t){function e(t,e){this.type=t,this.msg=e}return __extends(e,t),e.IO_ERROR="io_error",e}(t.Event),t.IOErrorEvent=e})(TECH);var __hasProp={}.hasOwnProperty,__extends=function(t,e){function n(){this.constructor=t}for(var r in e)__hasProp.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};(function(t){var e;return e=function(t){function e(t,n){var r=this;this.type=t,this.id=null!=n?n:null,this.toString=function(){return e.prototype.toString.apply(r,arguments)}}return __extends(e,t),e.ADDED="added",e.UPDATED="updated",e.DELETED="deleted",e.REMOVED="removed",e.FAILD="faild",e.prototype.toString=function(){return"ModelEvent:: type:"+this.type+"id:"+this.id},e}(t.Event),t.ModelEvent=e})(TECH);var BaseModel,_this=this,__indexOf=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};BaseModel=function(){function t(e){var n=this;this.toMsgPack=function(){return t.prototype.toMsgPack.apply(n,arguments)},this.toJSON=function(){return t.prototype.toJSON.apply(n,arguments)},this.toFormArray=function(){return t.prototype.toFormArray.apply(n,arguments)},this.toDict=function(){return t.prototype.toDict.apply(n,arguments)},this.update=function(){return t.prototype.update.apply(n,arguments)},this.save=function(){return t.prototype.save.apply(n,arguments)},this.bindData=function(){return t.prototype.bindData.apply(n,arguments)},null!=e&&this.bindData(e)}return t.url="",t.loadCB=null,t.collection=[],t.length=0,t._isLoaded=!1,t.dataType="json",t.contentType="application/json",t._dispatcher=new EventDispatcher,t.isUnique=!1,t.load=function(t,e){return t&&""===this.url&&(this.url=t),e&&(this.loadCB=e),$.ajax({url:this.url,dataType:this.dataType,contentType:this.contentType,success:this._success,error:this._error}),this},t.queried=!1,t.queriedCollection=[],t.isLoaded=function(){return t._isLoaded},t.get=function(t){var e;if(1>this.collection.length)throw Error("has not entity.");return e=_.find(this.collection,function(e){return e.id===t}),e?e:null},t.on=function(t,e){return this._dispatcher.addEventListener(t,e),this},t.off=function(t,e){return this._dispatcher.removeEventListener(t,e),this},t._success=function(e){return t._isLoaded=!0,t._appendToCollection(e),t._dispatcher.dispatchEvent(new TECH.Event(TECH.Event.COMPLETE))},t._error=function(t){return console.warn(t),this._dispatcher.dispatchEvent(new TECH.IOErrorEvent(TECH.IOErrorEvent.IO_ERROR,"load failed"))},t._appendToCollection=function(e){var n,r,o;for(r=0,o=e.length;o>r;r++)n=e[r],t.collection.push(new t(n));t.isUnique&&(t.collection=Gyosen.unique(t.collection)),t.length=t.collection.length,null!=t.loadCB&&t.loadCB.apply()},t.filter=function(t){var e,n,r,o,i;for(this.queried||(this.queriedCollection=this.collection,this.queried=!0),i=this.queriedCollection,r=0,o=i.length;o>r;r++)e=i[r],n=t(e),n&&results.push(n);return this.queriedCollection=results,this},t.prototype.id=null,t.prototype.propNames=[],t.prototype.bindData=function(t){var e,n;n=[];for(e in t)this.propNames.push(e),n.push(this[e]=t[e]);return n},t.prototype.save=function(t){var e,n=this;t||(t=this.toFormArray()),e=this.constructor,$.ajax({url:e.url,method:"POST",data:t,success:function(t){return n.bindData(t),e.collection.unshift(n),e._dispatcher.dispatchEvent(new TECH.ModelEvent(TECH.ModelEvent.ADDED,n.id))},error:function(){return e._dispatcher.dispatchEvent(new TECH.IOErrorEvent(TECH.IOErrorEvent.IO_ERROR))}})},t.prototype.update=function(t){var e,n=this;e=this.constructor,$.ajax({url:e.url+this.id,method:"PUT",data:t,success:function(t){return n.bindData(t),e._dispatcher.dispatchEvent(new TECH.ModelEvent(TECH.ModelEvent.UPDATED,n.id))},error:function(){return e._dispatcher.dispatchEvent(new TECH.IOErrorEvent(TECH.IOErrorEvent.IO_ERROR))}})},t.prototype.destroy=function(){var t,e=this;t=this.constructor,$.ajax({url:t.url+this.id,method:"DELETE",dataType:"json",success:function(n){var r,o,i;for(r=0,o=t.collection.length;o>r&&(i=t.collection[r],i.id!==n.id);)r++;return t.collection=t.collection.splice(r,1),t._dispatcher.dispatchEvent(new TECH.ModelEvent(TECH.ModelEvent.DELETED,e.id))},error:function(){return t._dispatcher.dispatchEvent(new TECH.IOErrorEvent(TECH.IOErrorEvent.IO_ERROR))}})},t.prototype.throwError=function(t){throw t},t.prototype.toDict=function(){var t,e,n,r,o;for(e={},o=this.propNames,n=0,r=o.length;r>n;n++)t=o[n],e[t]=this[t];return e},t.prototype.toFormArray=function(){var t,e,n,r,o,i,s;for(n=[],i=this.propNames,s=[],r=0,o=i.length;o>r;r++)t=i[r],e={},e.name=t,e.value=this[t],s.push(n.push(e));return s},t.prototype.toJSON=function(){return JSON.stringify(this.toDict())},t.prototype.toMsgPack=function(){if(!msgpack&&0>__indexOf.call(window,"msgpack"))throw Error("msgpack.js not found....");return msgpack.pack(this.toDict())},t}.call(this);var TweetModel,__hasProp={}.hasOwnProperty,__extends=function(t,e){function n(){this.constructor=t}for(var r in e)__hasProp.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};TweetModel=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return __extends(e,t),e.url="/",e.prototype.text="",e.prototype.created_at=null,e.prototype.updated_at=null,e}(BaseModel);var EditView;EditView=function(){function t(t){this.el=_.template(this._template,{id:t.id,text:t.text})}return t.prototype.el=null,t.prototype._template='<form id="editView" action="/<%= id %>" method="PUT"><input type="text" name="text" value="<%= text %>"><button type="button" class="send btn btn-primary btn-mini">OK</button><button type="button" class="cancel btn btn-mini">&times;</button></form>',t}(),function(t){var e;return e=function(){function t(t){this.el=_.template(this._template,{id:t.id,text:t.text,created_at:t.created_at})}return t.prototype.el=null,t.prototype._template='<article id="tweetlist<%= id %>" class="article"><section class="icon"><img src="/assets/images/icon.jpg"></section><section class="tweet"><header>username</header><section class="tweetBody"><%= text %></section><footer><%= created_at %></footer></section></article>',t}(),t.IndexListView=e}(TECH),function(t){var e;return e=function(){function t(){this.el=e}var e;return t.prototype.el=null,e='<div><header><h2>New Tweet</h2><a href="#" class="close" data-dismiss="alert">&times;</a></header><form id="newForm" class="form" action="/create" method="POST"><div class="controls"><textarea name="text"></textarea></div><div><button id="sendTweet" type="submit" class="btn btn-primary">送信</button></div></form></div>',t}(),t.NewView=e}(TECH);var ShowView;ShowView=function(){function t(t){this.el=_.template(this._template,{id:t.sid,text:t.text,created_at:t.created_at})}return t.prototype.el=null,t.prototype._template='<header><section class="icon"><a href="#" class="close closeShow" data-dismiss="alert">&times;</a><img src="/assets/images/icon.jpg" width="50"></section><section class="name">username</section></header><section class="tweet"><%= text %></section><footer><span class="ed"><a href="#" class="edit">[edit]</a></span><span class="del"><a href="/<%= id %>" data-delete="<%= id %>" class="delete">[del]</a></span><%= created_at %></footer>',t}();